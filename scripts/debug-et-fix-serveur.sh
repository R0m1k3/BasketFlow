#!/bin/bash
# üîß DEBUG ET FIX AUTOMATIQUE - Basket Flow Serveur Priv√©
# Ce script diagnostique ET corrige automatiquement tous les probl√®mes

set -e

echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo "  üîß DEBUG & FIX AUTOMATIQUE - BASKET FLOW"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo ""

# Couleurs
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# ============================================
# 1. V√âRIFIER DOCKER
# ============================================
echo "1Ô∏è‚É£ V√âRIFICATION DOCKER"
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"

if ! command -v docker &> /dev/null; then
    echo -e "${RED}‚ùå Docker n'est pas install√©${NC}"
    exit 1
fi
echo -e "${GREEN}‚úÖ Docker install√©${NC}"

if ! command -v docker-compose &> /dev/null; then
    echo -e "${RED}‚ùå Docker Compose n'est pas install√©${NC}"
    exit 1
fi
echo -e "${GREEN}‚úÖ Docker Compose install√©${NC}"

# ============================================
# 2. V√âRIFIER LES CONTENEURS
# ============================================
echo ""
echo "2Ô∏è‚É£ V√âRIFICATION CONTENEURS"
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"

POSTGRES_RUNNING=$(docker ps --filter "name=basket_postgres" --format "{{.Names}}" | wc -l)
BACKEND_RUNNING=$(docker ps --filter "name=basket_backend" --format "{{.Names}}" | wc -l)
FRONTEND_RUNNING=$(docker ps --filter "name=basket_frontend" --format "{{.Names}}" | wc -l)

if [ "$POSTGRES_RUNNING" -eq 0 ]; then
    echo -e "${RED}‚ùå PostgreSQL non actif${NC}"
    echo "   ‚Üí D√©marrage de PostgreSQL..."
    docker-compose up -d postgres
    sleep 15
else
    echo -e "${GREEN}‚úÖ PostgreSQL actif${NC}"
fi

if [ "$BACKEND_RUNNING" -eq 0 ]; then
    echo -e "${RED}‚ùå Backend non actif${NC}"
else
    echo -e "${GREEN}‚úÖ Backend actif${NC}"
fi

if [ "$FRONTEND_RUNNING" -eq 0 ]; then
    echo -e "${RED}‚ùå Frontend non actif${NC}"
else
    echo -e "${GREEN}‚úÖ Frontend actif${NC}"
fi

# ============================================
# 3. TESTER POSTGRESQL
# ============================================
echo ""
echo "3Ô∏è‚É£ TEST POSTGRESQL"
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"

if docker exec basket_postgres pg_isready -U basketuser -p 4532 > /dev/null 2>&1; then
    echo -e "${GREEN}‚úÖ PostgreSQL accepte les connexions${NC}"
else
    echo -e "${RED}‚ùå PostgreSQL ne r√©pond pas${NC}"
    echo "   ‚Üí Red√©marrage de PostgreSQL..."
    docker-compose restart postgres
    sleep 15
fi

# ============================================
# 4. V√âRIFIER LES TABLES
# ============================================
echo ""
echo "4Ô∏è‚É£ V√âRIFICATION TABLES"
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"

TABLES=$(docker exec basket_postgres psql -U basketuser -d basketdb -p 4532 -t -c "SELECT COUNT(*) FROM information_schema.tables WHERE table_schema = 'public' AND table_name IN ('User', 'League', 'Team', 'Broadcaster', 'Match')" 2>/dev/null | tr -d ' ')

if [ "$TABLES" -ge 5 ]; then
    echo -e "${GREEN}‚úÖ Tables principales existent ($TABLES/5)${NC}"
    
    # Lister les tables
    echo ""
    echo "Tables trouv√©es :"
    docker exec basket_postgres psql -U basketuser -d basketdb -p 4532 -c "\dt" 2>/dev/null | grep -E "(User|League|Team|Broadcaster|Match)" || echo "   Erreur lors de la liste"
else
    echo -e "${RED}‚ùå Tables manquantes ($TABLES/5)${NC}"
    echo ""
    echo "   ‚Üí CR√âATION DES TABLES AVEC init.sql..."
    
    # V√©rifier si init.sql existe
    if [ -f "init.sql" ]; then
        docker cp init.sql basket_postgres:/tmp/init.sql
        docker exec basket_postgres psql -U basketuser -d basketdb -p 4532 -f /tmp/init.sql > /dev/null 2>&1
        echo -e "${GREEN}   ‚úÖ Tables cr√©√©es avec init.sql${NC}"
    else
        echo -e "${YELLOW}   ‚ö†Ô∏è  init.sql introuvable, cr√©ation manuelle...${NC}"
        
        # Cr√©er les tables manuellement
        docker exec basket_postgres psql -U basketuser -d basketdb -p 4532 <<'EOSQL'
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

CREATE TABLE IF NOT EXISTS "User" (
    id VARCHAR(36) PRIMARY KEY DEFAULT uuid_generate_v4()::text,
    username VARCHAR(255) UNIQUE NOT NULL,
    email VARCHAR(255),
    password VARCHAR(255) NOT NULL,
    name VARCHAR(255) NOT NULL,
    role VARCHAR(50) NOT NULL DEFAULT 'user',
    "createdAt" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS "League" (
    id VARCHAR(36) PRIMARY KEY DEFAULT uuid_generate_v4()::text,
    name VARCHAR(255) UNIQUE NOT NULL,
    "shortName" VARCHAR(50) NOT NULL,
    country VARCHAR(100) NOT NULL,
    logo TEXT,
    color VARCHAR(20),
    "createdAt" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS "Team" (
    id VARCHAR(36) PRIMARY KEY DEFAULT uuid_generate_v4()::text,
    name VARCHAR(255) NOT NULL,
    "shortName" VARCHAR(100),
    logo TEXT,
    "leagueId" VARCHAR(36),
    "createdAt" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS "Broadcaster" (
    id VARCHAR(36) PRIMARY KEY DEFAULT uuid_generate_v4()::text,
    name VARCHAR(255) UNIQUE NOT NULL,
    logo TEXT,
    type VARCHAR(50) NOT NULL,
    "isFree" BOOLEAN NOT NULL DEFAULT false,
    "createdAt" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS "Match" (
    id VARCHAR(36) PRIMARY KEY DEFAULT uuid_generate_v4()::text,
    "leagueId" VARCHAR(36) NOT NULL,
    "homeTeamId" VARCHAR(36) NOT NULL,
    "awayTeamId" VARCHAR(36) NOT NULL,
    "dateTime" TIMESTAMP NOT NULL,
    venue TEXT,
    status VARCHAR(50) NOT NULL DEFAULT 'scheduled',
    "homeScore" INTEGER,
    "awayScore" INTEGER,
    "externalId" VARCHAR(255) UNIQUE,
    "createdAt" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS "MatchBroadcast" (
    id VARCHAR(36) PRIMARY KEY DEFAULT uuid_generate_v4()::text,
    "matchId" VARCHAR(36) NOT NULL,
    "broadcasterId" VARCHAR(36) NOT NULL,
    "streamUrl" TEXT,
    notes TEXT,
    "createdAt" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS "Config" (
    id VARCHAR(36) PRIMARY KEY DEFAULT uuid_generate_v4()::text,
    key VARCHAR(255) UNIQUE NOT NULL,
    value TEXT NOT NULL,
    description TEXT,
    "createdAt" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS "Session" (
    sid VARCHAR(255) PRIMARY KEY,
    sess JSON NOT NULL,
    expire TIMESTAMP NOT NULL
);
EOSQL
        
        echo -e "${GREEN}   ‚úÖ Tables cr√©√©es manuellement${NC}"
    fi
fi

# ============================================
# 5. V√âRIFIER L'ADMIN
# ============================================
echo ""
echo "5Ô∏è‚É£ V√âRIFICATION ADMIN"
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"

ADMIN_EXISTS=$(docker exec basket_postgres psql -U basketuser -d basketdb -p 4532 -t -c "SELECT COUNT(*) FROM \"User\" WHERE username='admin'" 2>/dev/null | tr -d ' ')

if [ "$ADMIN_EXISTS" = "1" ]; then
    echo -e "${GREEN}‚úÖ Admin existe${NC}"
    
    # Afficher l'admin
    docker exec basket_postgres psql -U basketuser -d basketdb -p 4532 -c "SELECT username, email, role FROM \"User\" WHERE username='admin'" 2>/dev/null
else
    echo -e "${RED}‚ùå Admin n'existe pas${NC}"
    echo ""
    echo "   ‚Üí CR√âATION DE L'ADMIN..."
    
    docker exec basket_postgres psql -U basketuser -d basketdb -p 4532 <<'EOSQL'
DELETE FROM "User" WHERE username = 'admin';

INSERT INTO "User" (id, username, email, password, name, role, "createdAt", "updatedAt")
VALUES (
    uuid_generate_v4()::text,
    'admin',
    'admin@basket.fr',
    '$2a$10$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p92ldGxad68LJZdL17lhWy',
    'Administrateur',
    'admin',
    CURRENT_TIMESTAMP,
    CURRENT_TIMESTAMP
);
EOSQL
    
    echo -e "${GREEN}   ‚úÖ Admin cr√©√©${NC}"
    
    # V√©rifier
    docker exec basket_postgres psql -U basketuser -d basketdb -p 4532 -c "SELECT username, email, role FROM \"User\" WHERE username='admin'" 2>/dev/null
fi

# ============================================
# 6. V√âRIFIER LE BACKEND
# ============================================
echo ""
echo "6Ô∏è‚É£ V√âRIFICATION BACKEND"
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"

# V√©rifier DATABASE_URL
DATABASE_URL=$(docker exec basket_backend env 2>/dev/null | grep DATABASE_URL | cut -d= -f2 || echo "")
if [ -n "$DATABASE_URL" ]; then
    echo -e "${GREEN}‚úÖ DATABASE_URL configur√©e${NC}"
else
    echo -e "${RED}‚ùå DATABASE_URL manquante${NC}"
fi

# V√©rifier JWT_SECRET
JWT_SECRET=$(docker exec basket_backend env 2>/dev/null | grep JWT_SECRET | cut -d= -f2 || echo "")
if [ -n "$JWT_SECRET" ]; then
    echo -e "${GREEN}‚úÖ JWT_SECRET configur√©${NC}"
else
    echo -e "${YELLOW}‚ö†Ô∏è  JWT_SECRET manquant${NC}"
fi

# Tester la connectivit√© PostgreSQL depuis le backend
echo ""
echo "Test connectivit√© Backend ‚Üí PostgreSQL :"
if docker exec basket_backend ping -c 2 basket_postgres > /dev/null 2>&1; then
    echo -e "${GREEN}‚úÖ Backend peut pinguer PostgreSQL${NC}"
else
    echo -e "${RED}‚ùå Backend ne peut pas pinguer PostgreSQL${NC}"
fi

# ============================================
# 7. RED√âMARRER LE BACKEND
# ============================================
echo ""
echo "7Ô∏è‚É£ RED√âMARRAGE BACKEND"
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"

echo "   ‚Üí Red√©marrage du backend..."
docker-compose restart backend > /dev/null 2>&1
sleep 10

if docker ps --filter "name=basket_backend" --format "{{.Names}}" | grep -q basket_backend; then
    echo -e "${GREEN}‚úÖ Backend red√©marr√©${NC}"
else
    echo -e "${RED}‚ùå Backend n'a pas red√©marr√©${NC}"
    echo ""
    echo "Logs backend (derni√®res lignes) :"
    docker-compose logs backend | tail -15
fi

# ============================================
# 8. TEST DE LOGIN
# ============================================
echo ""
echo "8Ô∏è‚É£ TEST DE LOGIN"
echo "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"

# Tester l'API de login
echo "Test de l'API de login..."

LOGIN_RESPONSE=$(curl -s -X POST http://localhost:3888/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin"}' \
  -w "\nHTTP_CODE:%{http_code}" 2>/dev/null || echo "CURL_ERROR")

HTTP_CODE=$(echo "$LOGIN_RESPONSE" | grep "HTTP_CODE" | cut -d: -f2)

if [ "$HTTP_CODE" = "200" ]; then
    echo -e "${GREEN}‚úÖ API de login fonctionne${NC}"
    echo ""
    echo "Token JWT :"
    echo "$LOGIN_RESPONSE" | grep -v "HTTP_CODE" | jq -r '.token' 2>/dev/null || echo "   (JSON non parsable)"
else
    echo -e "${RED}‚ùå API de login √©choue (HTTP $HTTP_CODE)${NC}"
    echo ""
    echo "R√©ponse :"
    echo "$LOGIN_RESPONSE" | grep -v "HTTP_CODE"
fi

# ============================================
# 9. R√âSUM√â FINAL
# ============================================
echo ""
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo "  üìä R√âSUM√â FINAL"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo ""

# Statut des conteneurs
docker-compose ps

echo ""
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo "  üîê INFORMATIONS DE CONNEXION"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo ""
echo "üåê Frontend : http://localhost:4000"
echo "üîê Login    : http://localhost:4000/login"
echo ""
echo "Identifiants :"
echo "  üë§ Identifiant : admin"
echo "  üîë Mot de passe : admin"
echo ""

# V√©rification finale
if [ "$ADMIN_EXISTS" = "1" ] || [ "$HTTP_CODE" = "200" ]; then
    echo -e "${GREEN}‚úÖ TOUT EST PR√äT ! Testez le login maintenant.${NC}"
else
    echo -e "${YELLOW}‚ö†Ô∏è  PROBL√àME D√âTECT√â${NC}"
    echo ""
    echo "Ex√©cutez manuellement :"
    echo "  docker exec basket_postgres psql -U basketuser -d basketdb -p 4532 <<'EOF'"
    echo "  DELETE FROM \"User\" WHERE username = 'admin';"
    echo "  INSERT INTO \"User\" (id, username, email, password, name, role)"
    echo "  VALUES (uuid_generate_v4()::text, 'admin', 'admin@basket.fr',"
    echo "          '\$2a\$10\$N9qo8uLOickgx2ZMRZoMyeIjZAgcfl7p92ldGxad68LJZdL17lhWy',"
    echo "          'Administrateur', 'admin');"
    echo "  EOF"
fi

echo ""
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
